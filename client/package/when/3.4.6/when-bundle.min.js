// when - 3.4.6-ef.1 @ 2015-01-08 15:04:20 
!function(a){a("when/lib/timer",["require"],function(a){var b,c,d,e;b=a;try{c=b("vertx")}catch(f){}return c&&"function"==typeof c.setTimer?(d=function(a,b){return c.setTimer(b,a)},e=c.cancelTimer):(d=function(a,b){return setTimeout(a,0|b)},e=function(a){return clearTimeout(a)}),{set:d,clear:e}})}("function"==typeof define&&define.amd?define:function(a){module.exports=a(require)}),function(a){a("when/lib/TimeoutError",[],function(){function a(b){Error.call(this),this.message=b,this.name=a.name,"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,a)}return a.prototype=Object.create(Error.prototype),a.prototype.constructor=a,a})}("function"==typeof define&&define.amd?define:function(a){module.exports=a()}),function(a){a("when/lib/decorators/timed",["require","../timer","../TimeoutError"],function(a){function b(a,b,d,e){return c.set(function(){a(d,e,b)},b)}var c=a("../timer"),d=a("../TimeoutError");return function(a){function e(a,c,d){b(f,a,c,d)}function f(a,b){b.resolve(a)}function g(a,b,c){var e="undefined"==typeof a?new d("timed out after "+c+"ms"):a;b.reject(e)}return a.prototype.delay=function(a){var b=this._beget();return this._handler.fold(e,a,void 0,b._handler),b},a.prototype.timeout=function(a,d){var e=this._beget(),f=e._handler,h=b(g,a,d,e._handler);return this._handler.visit(f,function(a){c.clear(h),this.resolve(a)},function(a){c.clear(h),this.reject(a)},f.notify),e},a}})}("function"==typeof define&&define.amd?define:function(a){module.exports=a(require)}),function(a){a("when/lib/decorators/array",[],function(){return function(a){function b(b){return new a(function(a,c){function e(a){f.push(a),0===--g&&c(f)}var f=[],g=d(b,a,e);0===g&&c(new RangeError("any() input must not be empty"))})}function c(b,c){return new a(function(a,e,f){function g(b){l>0&&(--l,j.push(b),0===l&&a(j))}function h(a){i>0&&(--i,k.push(a),0===i&&e(k))}var i,j=[],k=[],l=d(b,g,h,f);c=Math.max(c,0),i=l-c+1,l=Math.min(c,l),c>l?e(new RangeError("some() input must contain at least "+c+" element(s), but had "+l)):0===l&&a(j)})}function d(a,b,c,d){return l.call(a,function(a,e){return n(e).then(b,c,d),a+1},0)}function e(a,b){function c(a,c){return b(c,a)}return"object"!=typeof a?n([]):o(k(function(a,b){return n(a).fold(c,b)},a))}function f(a,b){return o(a).then(function(a){return o(k(b,a)).then(function(b){for(var c,d=b.length,e=new Array(d),f=0,g=0;d>f;++f)c=b[f],(void 0!==c||f in b)&&b[f]&&(e[g++]=a[f]);return e.length=g,e})})}function g(a){return o(k(function(a){function b(){return a.inspect()}return a=n(a),a.then(b,b)},a))}function h(a,b){var c=j(b);return arguments.length>2?l.call(a,c,arguments[2]):l.call(a,c)}function i(a,b){var c=j(b);return arguments.length>2?m.call(a,c,arguments[2]):m.call(a,c)}function j(a){return function(b,c,d){return n(b).then(function(b){return n(c).then(function(c){return a(b,c,d)})})}}function k(a,b){for(var c,d=b.length,e=new Array(d),f=0;d>f;++f)c=b[f],(void 0!==c||f in b)&&(e[f]=a(b[f],f));return e}var l=Array.prototype.reduce,m=Array.prototype.reduceRight,n=a.resolve,o=a.all;return a.any=b,a.some=c,a.settle=g,a.map=e,a.filter=f,a.reduce=h,a.reduceRight=i,a.prototype.spread=function(a){return this.then(o).then(function(b){return a.apply(void 0,b)})},a}})}("function"==typeof define&&define.amd?define:function(a){module.exports=a()}),function(a){a("when/lib/decorators/flow",[],function(){function a(){throw new TypeError("catch predicate must be a function")}function b(a,b){return c(b)?a instanceof b:b(a)}function c(a){return a===Error||null!=a&&a.prototype instanceof Error}function d(a){return("object"==typeof a||"function"==typeof a)&&null!==a}function e(a){return a}return function(c){function f(a,c){return function(d){return b(d,c)?a.call(this,d):j(d)}}function g(a,b,c,e){var f=a.call(b);return d(f)?h(f,c,e):c(e)}function h(a,b,c){return i(a).then(function(){return b(c)})}var i=c.resolve,j=c.reject,k=c.prototype["catch"];return c.prototype.done=function(a,b){this._handler.visit(this._handler.receiver,a,b)},c.prototype["catch"]=c.prototype.otherwise=function(b){return arguments.length<2?k.call(this,b):"function"!=typeof b?this.ensure(a):k.call(this,f(arguments[1],b))},c.prototype["finally"]=c.prototype.ensure=function(a){return"function"!=typeof a?this:this.then(function(b){return g(a,this,e,b)},function(b){return g(a,this,j,b)})},c.prototype["else"]=c.prototype.orElse=function(a){return this.then(void 0,function(){return a})},c.prototype["yield"]=function(a){return this.then(function(){return a})},c.prototype.tap=function(a){return this.then(a)["yield"](this)},c}})}("function"==typeof define&&define.amd?define:function(a){module.exports=a()}),function(a){a("when/lib/decorators/fold",[],function(){return function(a){return a.prototype.fold=function(b,c){var d=this._beget();return this._handler.fold(function(c,d,e){a._handler(c).fold(function(a,c,d){d.resolve(b.call(this,c,a))},d,this,e)},c,d._handler.receiver,d._handler),d},a}})}("function"==typeof define&&define.amd?define:function(a){module.exports=a()}),function(a){a("when/lib/decorators/inspect",[],function(){return function(a){function b(a){var b=a.state();return 0===b?{state:"pending"}:b>0?{state:"fulfilled",value:a.value}:{state:"rejected",reason:a.value}}return a.prototype.inspect=function(){return b(a._handler(this))},a}})}("function"==typeof define&&define.amd?define:function(a){module.exports=a()}),function(a){a("when/lib/decorators/iterate",[],function(){return function(a){function b(a,b,d,e){return c(function(b){return[b,a(b)]},b,d,e)}function c(a,b,e,f){function g(f,g){return d(e(f)).then(function(){return c(a,b,e,g)})}return d(f).then(function(c){return d(b(c)).then(function(b){return b?c:d(a(c)).spread(g)})})}var d=a.resolve;return a.iterate=b,a.unfold=c,a}})}("function"==typeof define&&define.amd?define:function(a){module.exports=a()}),function(a){a("when/lib/decorators/progress",[],function(){return function(a){return a.prototype.progress=function(a){return this.then(void 0,void 0,a)},a}})}("function"==typeof define&&define.amd?define:function(a){module.exports=a()}),function(a){a("when/lib/decorators/with",[],function(){return function(a){return a.prototype["with"]=a.prototype.withThis=function(a){var b=this._beget(),c=b._handler;return c.receiver=a,this._handler.chain(c,a),b},a}})}("function"==typeof define&&define.amd?define:function(a){module.exports=a()}),function(a){a("when/lib/decorators/unhandledRejection",["require","../timer"],function(a){function b(a){var b="object"==typeof a&&a.stack?a.stack:c(a);return a instanceof Error?b:b+" (WARNING: non-Error used)"}function c(a){var b=String(a);return"[object Object]"===b&&"undefined"!=typeof JSON&&(b=d(a,b)),b}function d(a,b){try{return JSON.stringify(a)}catch(a){return b}}function e(a){throw a}function f(){}var g=a("../timer");return function(a){function d(a){a.handled||(n.push(a),k("Potentially unhandled rejection ["+a.id+"] "+b(a.value)))}function h(a){var b=n.indexOf(a);b>=0&&(n.splice(b,1),l("Handled previous rejection ["+a.id+"] "+c(a.value)))}function i(a,b){m.push(a,b),o||(o=!0,o=g.set(j,0))}function j(){for(o=!1;m.length>0;)m.shift()(m.shift())}var k=f,l=f;"undefined"!=typeof console&&(k="undefined"!=typeof console.error?function(a){console.error(a)}:function(a){console.log(a)},l="undefined"!=typeof console.info?function(a){console.info(a)}:function(a){console.log(a)}),a.onPotentiallyUnhandledRejection=function(a){i(d,a)},a.onPotentiallyUnhandledRejectionHandled=function(a){i(h,a)},a.onFatalRejection=function(a){i(e,a.value)};var m=[],n=[],o=!1;return a}})}("function"==typeof define&&define.amd?define:function(a){module.exports=a(require)}),function(a){a("when/lib/makePromise",[],function(){return function(a){function b(a,b){this._handler=a===n?b:c(a)}function c(a){function b(a){e.resolve(a)}function c(a){e.reject(a)}function d(a){e.notify(a)}var e=new p;try{a(b,c,d)}catch(f){c(f)}return e}function d(a){return B(a)?a:new b(n,new q(k(a)))}function e(a){return new b(n,new q(new t(a)))}function f(){return Q}function g(){return new b(n,new p)}function h(a){function c(a,b,c){this[a]=b,0===--j&&c.become(new s(this))}var d,e,f,g,h=new p,j=a.length>>>0,k=new Array(j);for(d=0;d<a.length;++d)if(f=a[d],void 0!==f||d in a)if(C(f))if(e=l(f),g=e.state(),0===g)e.fold(c,d,k,h);else{if(!(g>0)){i(a,d+1,e),h.become(e);break}k[d]=e.value,--j}else k[d]=f,--j;else--j;return 0===j&&h.become(new s(k)),new b(n,h)}function i(a,b,c){var d,e,f;for(d=b;d<a.length;++d)f=a[d],C(f)&&(e=l(f),e!==c&&e.visit(e,void 0,e._unreport))}function j(a){if(Object(a)===a&&0===a.length)return f();var c,d,e=new p;for(c=0;c<a.length;++c)d=a[c],void 0!==d&&c in a&&k(d).visit(e,e.resolve,e.reject);return new b(n,e)}function k(a){return B(a)?a._handler.join():C(a)?m(a):new s(a)}function l(a){return B(a)?a._handler.join():m(a)}function m(a){try{var b=a.then;return"function"==typeof b?new r(b,a):new s(a)}catch(c){return new t(c)}}function n(){}function o(){}function p(a,c){b.createContext(this,c),this.consumers=void 0,this.receiver=a,this.handler=void 0,this.resolved=!1}function q(a){this.handler=a}function r(a,b){p.call(this),L.enqueue(new z(a,b,this))}function s(a){b.createContext(this),this.value=a}function t(a){b.createContext(this),this.id=++O,this.value=a,this.handled=!1,this.reported=!1,this._report()}function u(a,b){this.rejection=a,this.context=b}function v(a){this.rejection=a}function w(){return new t(new TypeError("Promise cycle"))}function x(a,b){this.continuation=a,this.handler=b}function y(a,b){this.handler=b,this.value=a}function z(a,b,c){this._then=a,this.thenable=b,this.resolver=c}function A(a,b,c,d,e){try{a.call(b,c,d,e)}catch(f){d(f)}}function B(a){return a instanceof b}function C(a){return("object"==typeof a||"function"==typeof a)&&null!==a}function D(a,c,d,e){return"function"!=typeof a?e.become(c):(b.enterContext(c),G(a,c.value,d,e),void b.exitContext())}function E(a,c,d,e,f){return"function"!=typeof a?f.become(d):(b.enterContext(d),H(a,c,d.value,e,f),void b.exitContext())}function F(a,c,d,e,f){return"function"!=typeof a?f.notify(c):(b.enterContext(d),I(a,c,e,f),void b.exitContext())}function G(a,b,c,d){try{d.become(k(a.call(c,b)))}catch(e){d.become(new t(e))}}function H(a,b,c,d,e){try{a.call(d,b,c,e)}catch(f){e.become(new t(f))}}function I(a,b,c,d){try{d.notify(a.call(c,b))}catch(e){d.notify(e)}}function J(a,b){b.prototype=M(a.prototype),b.prototype.constructor=b}function K(){}var L=a.scheduler,M=Object.create||function(a){function b(){}return b.prototype=a,new b};b.resolve=d,b.reject=e,b.never=f,b._defer=g,b._handler=k,b.prototype.then=function(a,b){var c=this._handler,d=c.join().state();if("function"!=typeof a&&d>0||"function"!=typeof b&&0>d)return new this.constructor(n,c);var e=this._beget(),f=e._handler;return c.chain(f,c.receiver,a,b,arguments.length>2?arguments[2]:void 0),e},b.prototype["catch"]=function(a){return this.then(void 0,a)},b.prototype._beget=function(){var a=this._handler,b=new p(a.receiver,a.join().context);return new this.constructor(n,b)},b.all=h,b.race=j,n.prototype.when=n.prototype.become=n.prototype.notify=n.prototype.fail=n.prototype._unreport=n.prototype._report=K,n.prototype._state=0,n.prototype.state=function(){return this._state},n.prototype.join=function(){for(var a=this;void 0!==a.handler;)a=a.handler;return a},n.prototype.chain=function(a,b,c,d,e){this.when({resolver:a,receiver:b,fulfilled:c,rejected:d,progress:e})},n.prototype.visit=function(a,b,c,d){this.chain(N,a,b,c,d)},n.prototype.fold=function(a,b,c,d){this.visit(d,function(d){a.call(c,b,d,this)},d.reject,d.notify)},J(n,o),o.prototype.become=function(a){a.fail()};var N=new o;J(n,p),p.prototype._state=0,p.prototype.resolve=function(a){this.become(k(a))},p.prototype.reject=function(a){this.resolved||this.become(new t(a))},p.prototype.join=function(){if(!this.resolved)return this;for(var a=this;void 0!==a.handler;)if(a=a.handler,a===this)return this.handler=w();return a},p.prototype.run=function(){var a=this.consumers,b=this.join();this.consumers=void 0;for(var c=0;c<a.length;++c)b.when(a[c])},p.prototype.become=function(a){this.resolved||(this.resolved=!0,this.handler=a,void 0!==this.consumers&&L.enqueue(this),void 0!==this.context&&a._report(this.context))},p.prototype.when=function(a){this.resolved?L.enqueue(new x(a,this.handler)):void 0===this.consumers?this.consumers=[a]:this.consumers.push(a)},p.prototype.notify=function(a){this.resolved||L.enqueue(new y(a,this))},p.prototype.fail=function(a){var b="undefined"==typeof a?this.context:a;this.resolved&&this.handler.join().fail(b)},p.prototype._report=function(a){this.resolved&&this.handler.join()._report(a)},p.prototype._unreport=function(){this.resolved&&this.handler.join()._unreport()},J(n,q),q.prototype.when=function(a){L.enqueue(new x(a,this))},q.prototype._report=function(a){this.join()._report(a)},q.prototype._unreport=function(){this.join()._unreport()},J(p,r),J(n,s),s.prototype._state=1,s.prototype.fold=function(a,b,c,d){E(a,b,this,c,d)},s.prototype.when=function(a){D(a.fulfilled,this,a.receiver,a.resolver)};var O=0;J(n,t),t.prototype._state=-1,t.prototype.fold=function(a,b,c,d){d.become(this)},t.prototype.when=function(a){"function"==typeof a.rejected&&this._unreport(),D(a.rejected,this,a.receiver,a.resolver)},t.prototype._report=function(a){L.afterQueue(new u(this,a))},t.prototype._unreport=function(){this.handled=!0,L.afterQueue(new v(this))},t.prototype.fail=function(a){b.onFatalRejection(this,void 0===a?this.context:a)},u.prototype.run=function(){this.rejection.handled||(this.rejection.reported=!0,b.onPotentiallyUnhandledRejection(this.rejection,this.context))},v.prototype.run=function(){this.rejection.reported&&b.onPotentiallyUnhandledRejectionHandled(this.rejection)},b.createContext=b.enterContext=b.exitContext=b.onPotentiallyUnhandledRejection=b.onPotentiallyUnhandledRejectionHandled=b.onFatalRejection=K;var P=new n,Q=new b(n,P);return x.prototype.run=function(){this.handler.join().when(this.continuation)},y.prototype.run=function(){var a=this.handler.consumers;if(void 0!==a)for(var b,c=0;c<a.length;++c)b=a[c],F(b.progress,this.value,this.handler,b.receiver,b.resolver)},z.prototype.run=function(){function a(a){d.resolve(a)}function b(a){d.reject(a)}function c(a){d.notify(a)}var d=this.resolver;A(this._then,this.thenable,a,b,c)},b}})}("function"==typeof define&&define.amd?define:function(a){module.exports=a()}),function(a){a("when/lib/Queue",[],function(){function a(a){this.head=this.tail=this.length=0,this.buffer=new Array(1<<a)}return a.prototype.push=function(a){return this.length===this.buffer.length&&this._ensureCapacity(2*this.length),this.buffer[this.tail]=a,this.tail=this.tail+1&this.buffer.length-1,++this.length,this.length},a.prototype.shift=function(){var a=this.buffer[this.head];return this.buffer[this.head]=void 0,this.head=this.head+1&this.buffer.length-1,--this.length,a},a.prototype._ensureCapacity=function(a){var b,c=this.head,d=this.buffer,e=new Array(a),f=0;if(0===c)for(b=this.length;b>f;++f)e[f]=d[f];else{for(a=d.length,b=this.tail;a>c;++f,++c)e[f]=d[c];for(c=0;b>c;++f,++c)e[f]=d[c]}this.buffer=e,this.head=0,this.tail=this.length},a})}("function"==typeof define&&define.amd?define:function(a){module.exports=a()}),function(a){a("when/lib/Scheduler",["require","./Queue"],function(a){function b(a){this._async=a,this._queue=new d(15),this._afterQueue=new d(5),this._running=!1;var b=this;this.drain=function(){b._drain()}}function c(a){for(;a.length>0;)a.shift().run()}var d=a("./Queue");return b.prototype.enqueue=function(a){this._add(this._queue,a)},b.prototype.afterQueue=function(a){this._add(this._afterQueue,a)},b.prototype._drain=function(){c(this._queue),this._running=!1,c(this._afterQueue)},b.prototype._add=function(a,b){a.push(b),this._running||(this._running=!0,this._async(this.drain))},b})}("function"==typeof define&&define.amd?define:function(a){module.exports=a(require)}),function(a){a("when/lib/async",["require"],function(a){var b,c;return b="undefined"!=typeof process&&null!==process&&"function"==typeof process.nextTick?function(a){process.nextTick(a)}:(c="function"==typeof MutationObserver&&MutationObserver||"function"==typeof WebKitMutationObserver&&WebKitMutationObserver)?function(a,b){function c(){var a=d;d=void 0,a()}var d,e=a.createElement("div"),f=new b(c);return f.observe(e,{attributes:!0}),function(a){d=a,e.setAttribute("class","x")}}(document,c):function(a){var b;try{b=a("vertx")}catch(c){}if(b){if("function"==typeof b.runOnLoop)return b.runOnLoop;if("function"==typeof b.runOnContext)return b.runOnContext}var d=setTimeout;return function(a){d(a,0)}}(a)})}("function"==typeof define&&define.amd?define:function(a){module.exports=a(require)}),function(a){a("when/lib/Promise",["require","./makePromise","./Scheduler","./async"],function(a){var b=a("./makePromise"),c=a("./Scheduler"),d=a("./async");return b({scheduler:new c(d)})})}("function"==typeof define&&define.amd?define:function(a){module.exports=a(require)}),function(a){a("when/when",["require","./lib/decorators/timed","./lib/decorators/array","./lib/decorators/flow","./lib/decorators/fold","./lib/decorators/inspect","./lib/decorators/iterate","./lib/decorators/progress","./lib/decorators/with","./lib/decorators/unhandledRejection","./lib/TimeoutError","./lib/Promise"],function(a){function b(a,b,c){var d=A.resolve(a);return arguments.length<2?d:arguments.length>3?d.then(b,c,arguments[3]):d.then(b,c)}function c(a){return new A(a)}function d(a){return function(){return f(a,this,B.call(arguments))}}function e(a){return f(a,this,B.call(arguments,1))}function f(a,b,c){return A.all(c).then(function(c){return a.apply(b,c)})}function g(){return new h}function h(){function a(a){d._handler.resolve(a)}function b(a){d._handler.reject(a)}function c(a){d._handler.notify(a)}var d=A._defer();this.promise=d,this.resolve=a,this.reject=b,this.notify=c,this.resolver={resolve:a,reject:b,notify:c}}function i(a){return a&&"function"==typeof a.then}function j(){return A.all(arguments)}function k(a){return b(a,A.all)}function l(a){return b(a,A.settle)}function m(a,c){return b(a,function(a){return A.map(a,c)})}function n(a,c){return b(a,function(a){return A.filter(a,c)})}function o(a){var c=B.call(arguments,1);return b(a,function(a){return c.unshift(a),A.reduce.apply(A,c)})}function p(a){var c=B.call(arguments,1);return b(a,function(a){return c.unshift(a),A.reduceRight.apply(A,c)})}var q=a("./lib/decorators/timed"),r=a("./lib/decorators/array"),s=a("./lib/decorators/flow"),t=a("./lib/decorators/fold"),u=a("./lib/decorators/inspect"),v=a("./lib/decorators/iterate"),w=a("./lib/decorators/progress"),x=a("./lib/decorators/with"),y=a("./lib/decorators/unhandledRejection"),z=a("./lib/TimeoutError"),A=[r,s,t,v,w,u,x,q,y].reduce(function(a,b){return b(a)},a("./lib/Promise")),B=Array.prototype.slice;return b.promise=c,b.resolve=A.resolve,b.reject=A.reject,b.lift=d,b["try"]=e,b.attempt=e,b.iterate=A.iterate,b.unfold=A.unfold,b.join=j,b.all=k,b.settle=l,b.any=d(A.any),b.some=d(A.some),b.race=d(A.race),b.map=m,b.filter=n,b.reduce=o,b.reduceRight=p,b.isPromiseLike=i,b.Promise=A,b.defer=g,b.TimeoutError=z,b})}("function"==typeof define&&define.amd?define:function(a){module.exports=a(require)}),function(a){a("when/lib/liftAll",[],function(){function a(a,b,c){return a[c]=b,a}function b(a){return"function"==typeof a?a.bind():Object.create(a)}return function(c,d,e,f){return"undefined"==typeof d&&(d=a),Object.keys(f).reduce(function(a,b){var e=f[b];return"function"==typeof e?d(a,c(e),b):a},"undefined"==typeof e?b(f):e)}})}("function"==typeof define&&define.amd?define:function(a){module.exports=a()}),function(a){a("when/callbacks",["require","./when","./lib/liftAll"],function(a){function b(a,b){return c(a,this,b||[])}function c(a,b,c){return l.all(c).then(function(c){var d=l._defer();return c.push(j(d._handler.resolve,d._handler),j(d._handler.reject,d._handler)),a.apply(b,c),d})}function d(a){return c(a,this,n.call(arguments,1))}function e(a){var b=arguments.length>1?n.call(arguments,1):[];return function(){return c(a,this,b.concat(n.call(arguments)))}}function f(a,b,c){return m(e,b,c,a)}function g(a,b){return function(){var c=this;return l.all(arguments).then(function(d){var e,f,g=l._defer();return"callback"in b&&(e=h(d,b.callback)),"errback"in b&&(f=h(d,b.errback)),e>f?(i(d,f,g._handler.reject,g._handler),i(d,e,g._handler.resolve,g._handler)):(i(d,e,g._handler.resolve,g._handler),i(d,f,g._handler.reject,g._handler)),a.apply(c,d),g})}}function h(a,b){return 0>b?a.length+b+2:b}function i(a,b,c,d){null!=b&&(c=j(c,d),0>b&&(b=a.length+b+2),a.splice(b,0,c))}function j(a,b){return function(){arguments.length>1?a.call(b,n.call(arguments)):a.apply(b,arguments)}}var k=a("./when"),l=k.Promise,m=a("./lib/liftAll"),n=Array.prototype.slice;return{lift:e,liftAll:f,apply:b,call:d,promisify:g}})}("function"==typeof define&&define.amd?define:function(a){module.exports=a(require)}),function(a){a("when/cancelable",[],function(){return function(a,b){return a.cancel=function(){try{a.reject(b(a))}catch(c){a.reject(c)}return a.promise},a}})}("function"==typeof define&&define.amd?define:function(a){module.exports=a()}),function(a){a("when/delay",["require","./when"],function(a){var b=a("./when");return function(a,c){return b(c).delay(a)}})}("function"==typeof define&&define.amd?define:function(a){module.exports=a(require)}),function(a){a("when/function",["require","./when","./lib/liftAll"],function(a){function b(a,b){return d(a,this,b||[])}function c(a){var b=arguments.length>1?j.call(arguments,1):[];return function(){return d(a,this,b.concat(j.call(arguments)))}}function d(a,b,c){return 0===c.length?h.call(b,a):h.apply(b,[a].concat(c))}function e(a,b,d){return i(c,b,d,a)}function f(a){var b=j.call(arguments,1);return function(){var c=this,d=j.call(arguments),e=h.apply(c,[a].concat(d));return g.reduce(b,function(a,b){return b.call(c,a)},e)}}var g=a("./when"),h=g["try"],i=a("./lib/liftAll"),j=Array.prototype.slice;return{lift:c,liftAll:e,call:h,apply:b,compose:f}})}("function"==typeof define&&define.amd?define:function(a){module.exports=a(require)}),function(a){a("when/generator",["require","./when"],function(a){function b(a){return function(){return e(a,this,arguments)}}function c(a){return e(a,this,h.call(arguments,1))}function d(a,b){return e(a,this,b||[])}function e(a,b,c){function d(a){return g.step("next",a)}function e(a){return g.step("throw",a)}var g=new f(d,e,a.apply(b,c));return g.step("next",void 0)}function f(a,b,c){this.next=a,this.error=b,this.iterator=c}var g=a("./when"),h=Array.prototype.slice;return f.prototype.step=function(a,b){try{return this._continue(a,b)}catch(c){return g.reject(c)}},f.prototype._continue=function(a,b){var c=this.iterator[a](b);return c.done?c.value:g(c.value,this.next,this.error)},{lift:b,call:c,apply:d}})}("function"==typeof define&&define.amd?define:function(a){module.exports=a(require)}),function(a){a("when/guard",["require","./when"],function(a){function b(a,b){return function(){var c=e.call(arguments);return d(a()).withThis(this).then(function(a){return d(b.apply(this,c))["finally"](a)})}}function c(a){function b(){c=Math.max(c-1,0),e.length>0&&e.shift()(b)}var c=0,e=[];return function(){return d.promise(function(d){a>c?d(b):e.push(d),c+=1})}}var d=a("./when"),e=Array.prototype.slice;return b.n=c,b})}("function"==typeof define&&define.amd?define:function(a){module.exports=a(require)}),function(a){a("when/keys",["require","./when"],function(a){function b(a){function b(a,b,c){this[a]=b,0===--i&&c.resolve(g)}for(var c,d=e._defer(),f=e._handler(d),g={},h=Object.keys(a),i=h.length,j=0;j<h.length;++j)c=h[j],e._handler(a[c]).fold(b,c,g,f);return 0===i&&f.resolve(g),d}function c(a,c){function d(a,b){return c(b,a)}return f(a).then(function(a){return b(Object.keys(a).reduce(function(b,c){return b[c]=f(a[c]).fold(d,c),b},{}))})}var d=a("./when"),e=d.Promise,f=d.resolve;return{all:d.lift(b),map:c}})}("function"==typeof define&&define.amd?define:function(a){module.exports=a(require)}),function(a){a("when/monitor/error",[],function(){function a(a){try{throw new Error}catch(b){a.stack=b.stack}}function b(a){a.stack=(new Error).stack}function c(a){return e(a)}function d(a){var b=new Error;return b.stack=c(a),b}function e(a){for(var b=!1,c="",d=0;d<a.length;++d)b?c+="\n"+a[d]:(c+=a[d],b=!0);return c}var f,g,h;return Error.captureStackTrace?(f=function(a){return a&&a.stack&&a.stack.split("\n")},h=c,g=Error.captureStackTrace):(f=function(a){var b=a&&a.stack&&a.stack.split("\n");return b&&a.message&&b.unshift(a.message),b},function(){var e=new Error;"string"!=typeof e.stack?(h=c,g=a):(h=d,g=b)}()),{parse:f,format:h,captureStack:g}})}("function"==typeof define&&define.amd?define:function(a){module.exports=a()}),function(a){a("when/monitor/PromiseMonitor",["require","../lib/timer","./error"],function(a){function b(a){this.logDelay=0,this.stackFilter=g,this.stackJumpSeparator=f,this.filterDuplicateFrames=!0,this._reporter=a,"function"==typeof a.configurePromiseMonitor&&a.configurePromiseMonitor(this),this._traces=[],this._traceTask=0;var b=this;this._doLogTraces=function(){b._logTraces()}}function c(a,b,c){b.length>1&&(b[0]=c,a.push.apply(a,b))}function d(a,b){return b.filter(function(b){return!a.test(b)})}function e(a){return!a.handler.handled}var f="from execution context:",g=/[\s\(\/\\](node|module|timers)\.js:|when([\/\\]{1,2}(lib|monitor|es6-shim)[\/\\]{1,2}|\.js)|(new\sPromise)\b|(\b(PromiseMonitor|ConsoleReporter|Scheduler|RunHandlerTask|ProgressTask|Promise|.*Handler)\.[\w_]\w\w+\b)|\b(tryCatch\w+|getHandler\w*)\b/i,h=a("../lib/timer").set,i=a("./error"),j=[];return b.prototype.monitor=function(a){var b=this;return a.createContext=function(a,c){a.context=b.createContext(a,c)},a.enterContext=function(a){j.push(a.context)},a.exitContext=function(){j.pop()},a.onPotentiallyUnhandledRejection=function(a,c){return b.addTrace(a,c)},a.onPotentiallyUnhandledRejectionHandled=function(a){return b.removeTrace(a)},a.onFatalRejection=function(a,c){return b.fatal(a,c)},this},b.prototype.createContext=function(a,b){var c={parent:b||j[j.length-1],stack:void 0};return i.captureStack(c,a.constructor),c},b.prototype.addTrace=function(a,b){var c,d;for(d=this._traces.length-1;d>=0&&(c=this._traces[d],c.handler!==a);--d);d>=0?c.extraContext=b:this._traces.push({handler:a,extraContext:b}),this.logTraces()},b.prototype.removeTrace=function(){this.logTraces()},b.prototype.fatal=function(a,b){var c=new Error;c.stack=this._createLongTrace(a.value,a.context,b).join("\n"),h(function(){throw c},0)},b.prototype.logTraces=function(){this._traceTask||(this._traceTask=h(this._doLogTraces,this.logDelay))},b.prototype._logTraces=function(){this._traceTask=void 0,this._traces=this._traces.filter(e),this._reporter.log(this.formatTraces(this._traces))},b.prototype.formatTraces=function(a){return a.map(function(a){return this._createLongTrace(a.handler.value,a.handler.context,a.extraContext)},this)},b.prototype._createLongTrace=function(a,b,c){var e=i.parse(a)||[String(a)+" (WARNING: non-Error used)"];return e=d(this.stackFilter,e,0),this._appendContext(e,b),this._appendContext(e,c),this.filterDuplicateFrames?this._removeDuplicates(e):e},b.prototype._removeDuplicates=function(a){var b={},c=this.stackJumpSeparator,d=0;return a.reduceRight(function(a,e,f){return 0===f?a.unshift(e):e===c?d>0&&(a.unshift(e),d=0):b[e]||(b[e]=!0,a.unshift(e),++d),a},[])},b.prototype._appendContext=function(a,b){a.push.apply(a,this._createTrace(b))},b.prototype._createTrace=function(a){for(var b,e=[];a;)b=i.parse(a),b&&(b=d(this.stackFilter,b),c(e,b,this.stackJumpSeparator)),a=a.parent;return e},b})}("function"==typeof define&&define.amd?define:function(a){module.exports=a(require)}),function(a){a("when/monitor/ConsoleReporter",["require","./error"],function(a){function b(){this._previouslyReported=!1}function c(){var a,b,c,e;return"undefined"==typeof console?a=b=d:"function"==typeof console.error&&"function"==typeof console.dir?(b=function(a){console.error(a)},a=function(a){console.log(a)},"function"==typeof console.groupCollapsed&&(c=function(a){console.groupCollapsed(a)},e=function(){console.groupEnd()})):"function"==typeof console.log&&"undefined"!=typeof JSON&&(a=b=function(a){if("string"!=typeof a)try{a=JSON.stringify(a)}catch(b){}console.log(a)}),{msg:a,warn:b,groupStart:c||b,groupEnd:e||d}}function d(){}var e=a("./error"),f="[promises] Unhandled rejections: ",g="[promises] All previously unhandled rejections have now been handled";return b.prototype=c(),b.prototype.log=function(a){if(0===a.length)return void(this._previouslyReported&&(this._previouslyReported=!1,this.msg(g)));this._previouslyReported=!0,this.groupStart(f+a.length);try{this._log(a)}finally{this.groupEnd()}},b.prototype._log=function(a){for(var b=0;b<a.length;++b)this.warn(e.format(a[b]))},b})}("function"==typeof define&&define.amd?define:function(a){module.exports=a(require)}),function(a){a("when/monitor",["require","./monitor/PromiseMonitor","./monitor/ConsoleReporter"],function(a){var b=a("./monitor/PromiseMonitor"),c=a("./monitor/ConsoleReporter"),d=new b(new c);return function(a){return d.monitor(a)}})}("function"==typeof define&&define.amd?define:function(a){module.exports=a(require)}),function(a){a("when/node",["require","./when","./lib/liftAll","./lib/timer"],function(a){function b(a,b){return c(a,this,b||[])}function c(a,b,c){var g=n._defer();switch(c.length){case 2:e(g._handler,a,b,c);break;case 1:f(g._handler,a,b,c);break;default:d(g._handler,a,b,c)}return g}function d(a,b,c,d){n.all(d)._handler.fold(function(a,b,c){b.push(j(c)),a.apply(this,b)},b,c,a)}function e(a,b,c,d){n._handler(d[0]).fold(function(a,c,d){n._handler(a).fold(function(a,c,d){b.call(this,a,c,j(d))},c,this,d)},d[1],c,a)}function f(a,b,c,d){n._handler(d[0]).fold(function(a,b,c){a.call(this,b,j(c))},b,c,a)}function g(a){return c(a,this,q.call(arguments,1))}function h(a){var b=arguments.length>1?q.call(arguments,1):[];return function(){var d,e=b.length,f=arguments.length,g=new Array(f+e);for(d=0;e>d;++d)g[d]=b[d];for(d=0;f>d;++d)g[d+e]=arguments[d];return c(a,this,g)}}function i(a,b,c){return o(h,b,c,a)}function j(a){return function(b,c){b?a.reject(b):a.resolve(arguments.length>2?q.call(arguments,1):c)}}function k(a,b){function c(a){d(null,a)}function d(a,c){p(function(){b(a,c)},0)}return a=m(a),b&&a.then(c,d),a}function l(a){return function(b){return k(b,a)}}var m=a("./when"),n=m.Promise,o=a("./lib/liftAll"),p=a("./lib/timer").set,q=Array.prototype.slice;return{lift:h,liftAll:i,apply:b,call:g,createCallback:j,bindCallback:k,liftCallback:l}})}("function"==typeof define&&define.amd?define:function(a){module.exports=a(require)}),function(a){a("when/parallel",["require","./when"],function(a){var b=a("./when"),c=b.Promise.all,d=Array.prototype.slice;return function(a){return c(d.call(arguments,1)).then(function(c){return b.map(a,function(a){return a.apply(void 0,c)})})}})}("function"==typeof define&&define.amd?define:function(a){module.exports=a(require)}),function(a){a("when/pipeline",["require","./when"],function(a){var b=a("./when"),c=b.Promise.all,d=Array.prototype.slice;return function(a){var e=function(a,b){return e=function(a,b){return b(a)},b.apply(null,a)};return c(d.call(arguments,1)).then(function(c){return b.reduce(a,function(a,b){return e(a,b)},c)})}})}("function"==typeof define&&define.amd?define:function(a){module.exports=a(require)}),function(a){a("when/poll",["require","./when","./cancelable"],function(a){var b=a("./when"),c=b["try"],d=a("./cancelable");return function(a,e,f,g){function h(a){k.resolve(a)}function i(a){c(e).then(j,m),void 0!==a&&k.notify(a)}function j(){l||b(a(),function(a){b(f(a),function(b){return b?h(a):i(a)},function(){i(a)})},m)}var k,l,m;return l=!1,k=d(b.defer(),function(){l=!0}),m=k.reject,f=f||function(){return!1},"function"!=typeof e&&(e=function(a){return function(){return b().delay(a)}}(e)),g?i():j(),k.promise=Object.create(k.promise),k.promise.cancel=k.cancel,k.promise}})}("function"==typeof define&&define.amd?define:function(a){module.exports=a(require)
}),function(a){a("when/sequence",["require","./when"],function(a){var b=a("./when"),c=b.Promise.all,d=Array.prototype.slice;return function(a){function e(a){return f.push(a),f}var f=[];return c(d.call(arguments,1)).then(function(c){return b.reduce(a,function(a,d){return b(d.apply(void 0,c),e)},f)})}})}("function"==typeof define&&define.amd?define:function(a){module.exports=a(require)}),function(a){a("when/timeout",["require","./when"],function(a){var b=a("./when");return function(a,c){return b(c).timeout(a)}})}("function"==typeof define&&define.amd?define:function(a){module.exports=a(require)}),function(a){a("when/unfold",["require","./when"],function(a){return a("./when").unfold})}("function"==typeof define&&define.amd?define:function(a){module.exports=a(require)}),function(a){a("when/node/function",["require","../node"],function(a){return a("../node")})}("function"==typeof define&&define.amd?define:function(a){module.exports=a(require)}),function(a){a("when/unfold/list",["require","../when"],function(a){var b=a("../when").unfold;return function(a,c,d){function e(a,b){return f.push(a),b}var f=[];return b(a,c,e,d)["yield"](f)}})}("function"==typeof define&&define.amd?define:function(a){module.exports=a(require)}),function(a){a("when/monitor/console",["require","../monitor","../when"],function(a){var b=a("../monitor"),c=a("../when").Promise;return b(c)})}("function"==typeof define&&define.amd?define:function(a){module.exports=a(require)}),define(["when/when"],function(a){return a});